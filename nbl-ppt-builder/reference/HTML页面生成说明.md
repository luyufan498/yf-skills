# HTML 页面生成说明

## 目录
1. [子代理工作流程](#子代理工作流程)
2. [模板概述](#模板概述)
3. [模板清单](#模板清单)
4. [目录页生成规则](#目录页生成规则)
5. [选择模板的原则](#选择模板的原则)
6. [页面检测与生成](#页面检测与生成)

---

## 子代理工作流程

### ⚠️ 工作目录重要说明

**所有生成的 HTML 文件必须保存到指定的工作目录下**，确保后续检测和 PPT 生成的路径正确。

**工作目录结构：**
```
ppt_{主题}/
├── 01_home.html
├── 02_toc.html
├── 03_背景介绍.html
├── ...
└── images/
    ├── logo.png
    ├── home_decoration.svg
    ├── toc_decoration.svg
    └── end_decoration.svg
```

- 子代理生成页面时必须保存到工作目录的完整路径
- 调用检测脚本时必须使用完整路径

### 文件命名规范

格式：`{页码:02d}_{简短描述}.html`
- 封面页：`01_home.html`
- 目录页：`02_toc.html`、`03_toc.html` 等
- 内容页：`03_背景介绍.html`、`04_问题分析.html` 等
- 结束页：`16_end.html`

页码必须是 2 位数字，不足前面补 0。

### 工作流程

```
输入：内容页信息（页码、标题、文字、数据、图片等）
↓
参考：reference/HTML页面生成说明.md
↓
分析：内容类型、信息密度、视觉重点、可用资源
↓
选择：最佳匹配的模板（必须参考模板选择原则）
↓
生成：HTML 文件，替换所有占位符，设置正确页码
↓
保存：使用页码命名，保存到工作目录完整路径
↓
验证：调用检测脚本验证页面质量
└─ 返回检测结果（ok/warning/error）
↓
根据检测结果决定：
├─ ✅ ok：继续下一个页面
├─ ⚠️ warning：记录问题，继续
└─ ❌ error：调整内容或选择其他模板，重新生成（最多3次，如果无法调整成功，则忽略错误后续尝试人工矫正）
↓
输出：最终 HTML 文件 + 检测结果
```

### 单页即时检测

每个内容页生成后立即调用检测脚本验证，详细脚本调用方法和检测结果处理请参考本文档 **"页面检测与生成"** 章节。

**检测原则：**
- 生成一页，检测一页
- 只要检测结果为 ok 才继续下一页
- error 状态需要修复后重新检测（最多重试 3 次）

---

## 模板概述

本模板库基于 Tailwind CSS，采用蓝色系配色（#0B3BD3、#1D4FED、#202665），适用于商务报告、数据分析、产品演示等场景。

### 统一特点
- **16:9 宽屏格式**：960px × 540px
- **标准化布局**：顶部标题区 + 中部内容区 + 底部页码
- **卡片式设计**：圆角、阴影、分层清晰
- **占位符系统**：双大括号格式 `{{变量名}}`

---

## 模板清单

### 基础页面模板

| 模板文件 | 用途 | 使用场景 |
|---------|------|---------|
| `template_home.html` | 封面页 | 第一页，展示主题和汇报人<br/>占位符：标题、汇报人姓名 |
| `template_toc.html` | 目录页 | 开场总目录、每个章节前的目录页<br/>占位符：目录项1-4，当前章节用蓝色高亮 |
| `template_end.html` | 结束页 | 最后一页，固定内容"感谢观看"，默认直接使用 |

### 正文内容模板

| 模板文件 | 用途 | 使用场景 |
|---------|------|---------|
| `template_content_single.html` | 单栏正文 | 文字较多的说明页、理论阐述、背景介绍<br/>结构：3段正文 + 3个要点框（横向排列） |
| `template_content_two_column.html` | 左右分栏 | 对比分析、优缺点展示、两个方案对比<br/>结构：左列（卡片+内容+2指标）+ 右列（卡片+内容+3步骤） |
| `template_content_three_cards.html` | 三列卡片 | 三个要点并列展示、特性介绍、服务/产品展示<br/>结构：3个横向卡片（标题+内容+状态标签） |
| `template_content_list.html` | 列表 | 要点列举、功能列表、注意事项<br/>结构：左列（标题+5项）+ 右列（标题+5项）+ 底部说明 |
| `template_content_flowchart_4steps.html` | 流程图（4步） | 简单流程、阶段划分<br/>结构：4个垂直流程卡片（标题+描述+箭头连接） |
| `template_content_flowchart_5steps.html` | 流程图（5步） | 复杂流程、详细工作流<br/>结构：5个垂直流程卡片（标题+描述+箭头连接） |
| `template_content_chart.html` | 数据图表 | 数据对比、趋势分析、统计数据展示<br/>结构：柱状图（2个数据系列，每个系列6个数据点） |
| `template_content_image_1.html` | 单图片 | 产品展示、核心图片介绍<br/>结构：章节标题 + 1张大图 |
| `template_content_image_2.html` | 双图片 | 前后对比、方案对比<br/>结构：2张图（左右并列） |
| `template_content_image_3.html` | 三图片 | 系列图片、流程配图<br/>结构：3张图（横向排列） |
| `template_content_image_4.html` | 四图片 | 四象限展示、多个案例<br/>结构：4张图（2×2网格） |

---

## 目录页生成规则

### ⚠️ 目录页重要说明

**每个章节（Section）开头必须生成一份目录页。**

**基本规则：**
- 封面页后必须有一份总目录页（`02_toc.html`），列出所有章节
- 每个章节开头必须生成一份目录页，高亮当前章节
- 目录页只列出章节标题，不列出具体内容页

**章节结构示例：**
```markdown
封面页：01_home.html
总目录：02_toc.html（列出所有章节，高亮第一章）

第一章：背景概述
- 目录页：03_toc.html（高亮第一章）
- 内容页：04_项目背景介绍.html
- 内容页：05_核心问题分析.html

第二章：核心内容
- 目录页：06_toc.html（高亮第二章）
- 内容页：07_关键要点一.html
- 内容页：08_关键要点二.html

结束页：12_end.html
```

**TOC 模板使用说明：**
- 当前章节标题使用蓝色高亮类 `text-[#0B3BD3]`
- 其他章节标题使用灰色类 `text-[#202665]`
- 最多支持4个章节项，可根据需要增减

---

## 选择模板的原则

### 决策流程（指导性）

选择最佳模板的原则流程：

```
1. 识别内容类型（文字/对比/流程/数据/图片）
   ↓
2. 评估信息密度（高/中/低）
   ↓
3. 确定视觉重点（文字/对比/流程/数据/图片）
   ↓
4. 检查可用资源（数据/图片）
   ↓
5. 考虑页面位置和模板多样性
   ↓
6. 选择最匹配的模板
```

### 快速参考表

| 内容类型 | 推荐模板 | 关键特征 |
|---------|---------|---------|
| 纯文字说明 | `single` | 单栏大段文字，带要点框 |
| 对比分析 | `two_column` | 左右两列，适合并列对比 |
| 3个要点并列 | `three_cards` | 三个横向卡片 |
| 列表列举 | `list` | 双列列表，适合要点展示 |
| 4-5步骤流程 | `flowchart_4steps/5steps` | 垂直流程图 |
| 数据展示 | `chart` | 柱状图等可视化 |
| 1-4张图片 | `image_1/2/3/4` | 图片展示布局 |

### 详细选择维度

#### 按信息密度

| 密度 | 适用场景 | 推荐模板 |
|------|---------|---------|
| **高** | 要点多、信息丰富 | `list`、`two_column`、`three_cards` |
| **中** | 内容中等，结构清晰 | `single`、`flowchart_4steps` |
| **低** | 内容简洁，视觉化强 | `flowchart_5steps`、`image` 系列 |

#### 按视觉重点

| 重点 | 适用场景 | 推荐模板 |
|------|---------|---------|
| **文字** | 理论介绍、背景说明 | `single` |
| **对比** | 方案对比、优缺点分析 | `two_column` |
| **流程** | 工作流程、步骤说明 | `flowchart` 系列 |
| **数据** | 数据对比、趋势分析 | `chart` |
| **图片** | 产品展示、案例配图 | `image` 系列 |

#### 按清单资源

| 可用资源 | 推荐模板 | 优先级 |
|---------|---------|--------|
| 有图表数据 | `chart` | 充分利用数据 |
| 有图片 | `image` 系列 | 优先用图片 |
| 都没有 | 根据内容类型选择 | 选择文字型模板 |

#### 按页面位置

| 位置 | 推荐模板 | 说明 |
|------|---------|------|
| 开场总目录后 | `toc` | 列出所有章节 |
| 章节开头 | `toc` | 高亮当前章节 |
| 中间内容 | 根据内容类型选择 | 核心内容区 |
| 结束前 | `single`、`three_cards` | 总结关键要点 |
| 最后 | `end` | 结束页 |

---

## 页面检测与生成

### ⚠️ 必须执行

**生成 PPT 页面后，必须先运行检测脚本，确认无问题后再生成 PPT 文件。**

### 检测流程（单页生成必须执行所有步骤）

```
1. 生成单个 HTML 页面
   ↓
2. 单页面检测（Playwright）← 步骤1：内容溢出检测
   ↓
3. 如有问题，修复后重试（最多3次）
   ↓
   ✅ Playwright 检测通过，继续下一步
   ↓
4. 单页 PPTX 检查← 步骤2：PPT语法检查
   ↓
5. 如有问题，修复后重试（最多3次）
   ↓
   ✅ PPTX 检测通过
   ↓
6. 完成单页 HTML 的生成
```

### 步骤1：Playwright 内容溢出检测

**在生成 HTML 页面后立即进行单页检测**：
```bash
cd  path/to/scripts && uv run validate_with_playwright.py /path/to/page.html
```

**示例**：
```bash
# 检测特定页面
cd  path/to/scripts && uv run validate_with_playwright.py /path/to/ppt_主题/03_背景介绍.html  -o /path/to/ppt/ppt_主题/tmp/03_背景介绍_validation_report.json
```

**注意**：
- 命令应在 nbl-ppt-builder SKILL 目录下执行
- 必须使用 `uv run` 调用 Python 验证脚本
- 路径必须是绝对路径或相对于 SKILL 目录的完整路径
- `-o` 参数可选，用于指定输出报告路径
- 如果输出路径不存在，应该创建路径

**返回值**：
| 返回值 | 状态 | 处理方式 |
|--------|------|----------|
| `0` | ✅ 正常 | 继续下一个页面 |
| `1` | ⚠️ 警告 | 记录问题，继续 |
| `2` | ❌ 错误 | 必须修复后重试 |

**检测项**：
| 检查项 | 说明 | 修复方式 |
|--------|------|----------|
| 内容溢出 | 卡片内容超出幻灯片底部（540px） | 1. 缩小字体：<br>   - 章节标题（顶部突出标题）：保持不变<br>   - 页面标题：按比例缩小（13.5pt→12pt→10.5pt）<br>   - 正文段落：最多缩小1-2号（12pt→11pt→10pt）<br>   - 卡片标题：保持不变<br>2. 压缩文字：减少代码显示示例，精炼语言表达<br>3. 减少信息量：优先保留核心要点，删除次要内容<br>4. **调整容器**：增加容器高度（如减小bottom值）<br>5. **减小内边距**：减小卡片的padding（如p-5→p-4） |
| 卡片内部内容溢出 | 卡片内容超出容器高度（内容超出容器边界） | 1. **调整容器**：增加容器高度，确保不与其他元素重叠<br>   - 例如：`bottom-[70px]` → `bottom-[53px]` 增加17px<br>2. **减小内边距**：减小卡片padding（p-5→p-4→p-3）<br>3. 缩小字体：按比例缩小正文和标题<br>4. 压缩文字：精炼表达，删除冗余描述 |
| 卡片重叠 | 两个或多个卡片区域重叠 | 调整布局，增加间距 |
| 边界裁切 | 标题、页码等元素被裁切 | 调整垂直位置 |

**溢出修复流程**：
1. 识别溢出卡片（查看报告中的 `title` 字段）
2. **步骤1：缩小字体**
   - 章节标题（顶部突出标题）：保持不变（18pt）
   - 页面标题：按比例缩小（13.5pt→12pt→10.5pt）
   - 正文段落：12pt→11pt→10pt（最多缩小两次）
   - 卡片标题：保持不变
3. 重新检测，如仍溢出则继续步骤2
4. **步骤2：压缩文字**
   - 减少代码显示示例
   - 精炼语言表达，去除冗余描述
5. 重新检测，如仍溢出则继续步骤3
6. **步骤3：减少信息量**
   - 保留核心要点，删除次要内容
   - 分页展示更多信息
7. 重新检测验证

### 步骤2：PPTX 预检测

对每一页生成的 HTML 文件进行快速检查（每页生成后必须要检测语法是否符合要求）：

```bash
cd  path/to/scripts && node pptx/generate_pptx.js --check /path/to/ppt_{主题}/页码_标题.html
```

**注意**：命令应在 nbl-ppt-builder SKILL 目录下执行。批量汇总检测由最终检查子代理执行，详细说明请参考 SKILL.md 的"最终检查与整合"章节。

**检测内容**：
| 检查项 | 说明 | 修复方式 |
|--------|------|----------|
| HTML 尺寸验证 | 是否匹配 16:9 布局 | 调整页面尺寸 |
| 内容溢出检测 | 是否超出幻灯片边界 | 调整内容 |
| 未包装文本 | DIV 中是否有未包装的文本 | 用 P/H1-H6/UL/OL 包装 |
| 手动列表符号 | 文本是否以列表符号开头 | 使用 UL/OL 标签 |
| 行内元素边距 | SPAN 等是否有 margin | 将 margin 移到父级元素 |
| CSS 渐变 | 是否使用了 CSS 渐变 | 改为图片 |
| 背景图片 | DIV 是否使用背景图片 | 使用 IMG 标签 |
| 占位符尺寸 | 是否有宽或高为 0 | 检查布局 CSS |
| 文本元素样式 | P/H1-H6 是否有 background/border/shadow | 改为 DIV 包裹 |

**检测通过后生成 PPT**：
```bash
cd  path/to/scripts &&  node pptx/generate_pptx.js /path/to/ppt_{主题} [输出文件名.pptx]
```

### 检测报告格式

**Playwright 报告**（`validation_report.json`）：
```json
{
  "file": "/path/to/page.html",
  "status": "error",
  "issues": [
    {
      "type": "A",
      "category": "content_overflow",
      "severity": "high",
      "description": "内容溢出幻灯片底部: 「卡片标题」超出 102px",
      "details": {
        "title": "卡片标题",
        "card_top": 115,
        "card_height": 527,
        "card_bottom": 642,
        "overflow": 102
      }
    }
  ]
}
```

### ⚠️ PPT 转换技术注意事项

#### 1. 占位符替换

**格式**：`{{变量名}}`，在模板文件中找到占位符后直接替换为实际内容。

**图片路径**：统一放在 `images/` 目录下，使用相对路径引用（如 `images/product1.png`）。

**页码格式**：2位数字，不足前面补0（01、02、03）。

#### 2. 颜色格式

**避免使用 oklch 颜色格式**，HTML 转换为 PPT 时无法正确渲染。

**推荐使用**：Hex 格式 `#0B3BD3` 或 RGB 格式 `rgb(11, 59, 211)`。

#### 3. SPAN 元素样式

SPAN 元素的格式化（颜色、字体、背景等）在 PPT 转换时可能无法正确显示。

**推荐实现**：所有视觉样式放在外层 `<div>`，内部使用 `<p>` 包裹文字，不含样式类。

#### 4. FontAwesome 图标

FontAwesome 图标在 PPT 中无法正确显示。避免使用特殊的图标字体。

**推荐使用 Unicode 字符替代**：`→`、`←`、`●`、`○`、`✓`、`✕`、`★`、`☆` 等。

#### 5. 字体大小参考

| 元素 | 推荐字体大小 | 说明 |
|------|----------|------|
| 章节标题（顶部突出） | 18pt | 保持不变 |
| 页面标题 | 13.5pt | 可缩小到 12pt/10.5pt |
| 正文段落 | 12pt | 可缩小到 11pt/10pt |
| 卡片标题 | 12pt | 保持不变 |
| 页码 | 9pt | 保持不变 |

#### 6. 内容溢出处理

**流程**：
1. 缩小字体大小（按上表参考）
2. 压缩文字表达
3. 减少信息量，分页展示

---

**版本**：v1.1
**更新日期**：2026年2月